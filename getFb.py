import numpy as np
from math import tan, atan


def gradEb(xkm1, ykm1, xk, yk, xkp1, ykp1, φk0):
    F = np.empty(6)
    F[0] = 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    F[1] = 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    F[2] = 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    F[3] = 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    F[4] = 2.0*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    F[5] = 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)
    return F


def hessEb(xkm1, ykm1, xk, yk, xkp1, ykp1, φk0):
    J11 = 2.0*((-2*xk + 2*xkp1)*(-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + 2*(-xk + xkp1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*(-(-2*xk + 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (-2*yk + 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J12 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkp1)*(xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkp1)*(-2*yk + 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykp1)**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-(2*xk - 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J13 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkp1)*(ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykp1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-(2*ykm1 - 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J14 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkp1)*(-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykp1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-(-2*xkm1 + 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J15 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-2*xk + 2*xkm1)*(-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-xk + xkm1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkp1)*(yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (2*yk - 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J16 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkm1)*(-xk + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkp1)*(-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykm1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*((-xk + xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J22 = 2.0*(2*(xk - xkp1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-2*yk + 2*ykp1)*(-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(2*xk - 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J23 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((xk - xkp1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)*(ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(2*ykm1 - 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J24 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((xk - xkp1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xkm1 + xkp1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xkm1 + 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J25 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-2*xk + 2*xkm1)*(-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-xk + xkm1)*(xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-yk + ykp1)*(yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (2*yk - 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J26 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkm1)*(-yk + ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (xk - xkp1)*(-yk + ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-2*yk + 2*ykm1)*(-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((xk - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J33 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*(2*(ykm1 - ykp1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + 2*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(2*ykm1 - 2*ykp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*xk - 2*xkm1 - 2*xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J34 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xkm1 + xkp1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (ykm1 - ykp1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xkm1 + 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J35 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-xk + xkm1)*(ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (2*yk - 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J36 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkm1)*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykm1)*(ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*xk - xkm1 - xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J44 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*(2*(-xkm1 + xkp1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + 2*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xkm1 + 2*xkp1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2*(4*yk - 2*ykm1 - 2*ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J45 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-xk + xkm1)*(-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + 1/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (2*yk - 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J46 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkm1)*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xkm1 + xkp1)*(-yk + ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xkm1 + xkp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))*(2*yk - ykm1 - ykp1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J55 = 2.0*((-2*xk + 2*xkm1)*(-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + 2*(-xk + xkm1)*(yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 - (2*yk - 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J56 = 2.0*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*((-xk + xkm1)**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-xk + xkm1)*(-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3 + (-yk + ykm1)*(yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*((-xk + xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (yk - ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    J66 = 2.0*(2*(-xk + xkm1)*(-yk + ykm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 + (-2*yk + 2*ykm1)*(-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2) + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)**2/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2 + 2.0*((-xk + xkm1)/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)) + (-yk + ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)*(-(-2*xk + 2*xkm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2 - (-2*yk + 2*ykm1)*((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**3)*(-2*tan(0.5*φk0) + 2*tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1)))))*(tan(0.5*atan(((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))))**2 + 1)/(1 + ((-xk + xkp1)*(yk - ykm1) - (xk - xkm1)*(-yk + ykp1))**2/((-xk + xkp1)*(xk - xkm1) + (-yk + ykp1)*(yk - ykm1))**2)**2
    return np.array([J11, J12, J13, J14, J15, J16, J12, J22, J23, J24, J25, J26, J13, J23, J33, J34, J35, J36, J14, J24, J34, J44, J45, J46, J15, J25, J35, J45, J55, J56, J16, J26, J36, J46, J56, J66]).reshape((6, 6))


# the last paramter incicates whether it is a circular shape (i.e. the two ends are connected)
def getFb(q, EI, nv, voronoiRefLen, φk0, isCircular=False):
    def loop(ci, l_k):
        xkm1 = q[ci]
        ykm1 = q[ci + 1]
        xk = q[ci + 2]
        yk = q[ci + 3]
        xkp1 = q[ci + 4]
        ykp1 = q[ci + 5]

        return (
            0.5 * EI * gradEb(xkm1, ykm1, xk, yk, xkp1, ykp1, φk0) / l_k,
            0.5 * EI * hessEb(xkm1, ykm1, xk, yk, xkp1, ykp1, φk0) / l_k
        )
    Fb = np.zeros(len(q))
    Jb = np.zeros((len(q), len(q)))
    for c in range(1, nv - 1):
        ci = 2 * c - 2
        cf = 2 * c + 4

        gradEnergy, hessEnergy = loop(ci, voronoiRefLen[c])

        Fb[ci:cf] -= gradEnergy

        Jb[ci:cf, ci:cf] -= hessEnergy
    if isCircular:  # additional node at start (i.e. c = 0)
        gradEnergy, hessEnergy = loop(-2, voronoiRefLen[0])

        Fb[-2:] -= gradEnergy[0:2]
        Fb[0:4] -= gradEnergy[2:6]

        Jb[-2:, -2:] -= hessEnergy[0:2, 0:2]
        Jb[-2:, 0:4] -= hessEnergy[0:2, 2:6]
        Jb[0:4, -2:] -= hessEnergy[2:6, 0:2]
        Jb[0:4, 0:4] -= hessEnergy[2:6, 2:6]
    if isCircular:  # additional node at end (i.e. c = nv - 1)
        gradEnergy, hessEnergy = loop(-4, voronoiRefLen[nv - 1])

        Fb[-4:] -= gradEnergy[0:4]
        Fb[0:2] -= gradEnergy[4:6]

        Jb[-4:, -4:] -= hessEnergy[0:4, 0:4]
        Jb[-4:, 0:2] -= hessEnergy[0:4, 4:6]
        Jb[0:2, -4:] -= hessEnergy[4:6, 0:4]
        Jb[0:2, 0:2] -= hessEnergy[4:6, 4:6]
    return Fb, Jb
